<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>회원가입 - 회원관리 시스템</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/mobile.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        .form-container {
            max-width: 600px;
            margin: 0 auto;
        }
        .password-toggle {
            cursor: pointer;
        }
        .verification-code {
            display: none;
        }
        .team-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .team-button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
        }
        .team-button.selected {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body class="mobile-optimized">
    <div class="mobile-container">
        <div class="mobile-header">
            <a href="/" class="back-button">←</a>
            <h1>회원가입</h1>
        </div>

        <div class="mobile-content">
            <form id="registerForm" class="mobile-form">
                <div class="form-group">
                    <label for="username">아이디</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="username" required minlength="4" maxlength="20">
                        <div class="input-group-append">
                            <button type="button" class="btn btn-outline-primary" id="checkUsernameBtn">
                                중복확인
                            </button>
                        </div>
                    </div>
                    <small class="form-text text-muted">4~20자의 영문, 숫자만 사용 가능합니다.</small>
                    <div id="usernameMessage" class="form-text"></div>
                </div>

                <div class="form-group">
                    <label for="email">이메일</label>
                    <div class="input-group">
                        <input type="email" class="form-control" id="email" required>
                        <div class="input-group-append">
                            <button type="button" class="btn btn-outline-primary" id="sendVerificationBtn">
                                인증
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group verification-group" style="display: none;">
                    <label for="verificationCode">인증번호</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="verificationCode" required>
                        <div class="input-group-append">
                            <button type="button" class="btn btn-outline-primary" id="verifyCodeBtn">
                                확인
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" class="form-control" id="password" required minlength="8">
                    <small class="form-text text-muted">8자 이상의 영문, 숫자, 특수문자를 포함해야 합니다.</small>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">비밀번호 확인</label>
                    <input type="password" class="form-control" id="confirmPassword" required>
                    <div id="passwordMessage" class="form-text"></div>
                </div>

                <button type="submit" class="btn btn-primary btn-block" id="submitBtn" disabled>가입하기</button>
            </form>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            let isUsernameAvailable = false;
            let isEmailVerified = false;

            // 아이디 중복확인
            $('#checkUsernameBtn').click(function() {
                const username = $('#username').val();
                if (!username) {
                    alert('아이디를 입력해주세요.');
                    return;
                }

                // 아이디 형식 검사
                if (!/^[a-zA-Z0-9]{4,20}$/.test(username)) {
                    $('#usernameMessage').removeClass('text-success').addClass('text-danger')
                        .text('4~20자의 영문, 숫자만 사용 가능합니다.');
                    isUsernameAvailable = false;
                    updateSubmitButton();
                    return;
                }

                $.post('/api/auth/check-username', { username })
                    .done(function(response) {
                        if (response.available) {
                            $('#usernameMessage').removeClass('text-danger').addClass('text-success')
                                .text('사용 가능한 아이디입니다.');
                            isUsernameAvailable = true;
                        } else {
                            $('#usernameMessage').removeClass('text-success').addClass('text-danger')
                                .text('이미 사용 중인 아이디입니다.');
                            isUsernameAvailable = false;
                        }
                        updateSubmitButton();
                    })
                    .fail(function(error) {
                        $('#usernameMessage').removeClass('text-success').addClass('text-danger')
                            .text('아이디 확인 중 오류가 발생했습니다.');
                        isUsernameAvailable = false;
                        updateSubmitButton();
                    });
            });

            // 비밀번호 확인
            $('#confirmPassword').on('input', function() {
                const password = $('#password').val();
                const confirmPassword = $(this).val();

                if (password === confirmPassword) {
                    $('#passwordMessage').removeClass('text-danger').addClass('text-success')
                        .text('비밀번호가 일치합니다.');
                } else {
                    $('#passwordMessage').removeClass('text-success').addClass('text-danger')
                        .text('비밀번호가 일치하지 않습니다.');
                }
            });

            // 인증번호 발송
            $('#sendVerificationBtn').click(function() {
                const email = $('#email').val();
                if (!email) {
                    alert('이메일을 입력해주세요.');
                    return;
                }

                $.post('/api/auth/send-verification', { email })
                    .done(function(response) {
                        alert('인증번호가 이메일로 발송되었습니다.');
                        $('.verification-group').show();
                    })
                    .fail(function(error) {
                        alert('인증번호 발송에 실패했습니다.');
                    });
            });

            // 인증번호 확인
            $('#verifyCodeBtn').click(function() {
                const email = $('#email').val();
                const code = $('#verificationCode').val();

                $.post('/api/auth/verify-code', { email, code })
                    .done(function(response) {
                        alert('인증번호가 확인되었습니다.');
                        $('#verificationCode').prop('disabled', true);
                        $('#verifyCodeBtn').prop('disabled', true);
                        isEmailVerified = true;
                        updateSubmitButton();
                    })
                    .fail(function(error) {
                        alert('인증번호가 일치하지 않습니다.');
                        isEmailVerified = false;
                        updateSubmitButton();
                    });
            });

            // 가입하기 버튼 상태 업데이트
            function updateSubmitButton() {
                const isPasswordValid = $('#password').val().length >= 8;
                const isPasswordMatch = $('#password').val() === $('#confirmPassword').val();
                $('#submitBtn').prop('disabled', !(isUsernameAvailable && isEmailVerified && isPasswordValid && isPasswordMatch));
            }

            // 회원가입 폼 제출
            $('#registerForm').submit(function(e) {
                e.preventDefault();
                
                if (!isUsernameAvailable) {
                    alert('아이디 중복확인을 해주세요.');
                    return;
                }

                if (!isEmailVerified) {
                    alert('이메일 인증을 완료해주세요.');
                    return;
                }

                const userData = {
                    username: $('#username').val(),
                    email: $('#email').val(),
                    password: $('#password').val(),
                    confirmPassword: $('#confirmPassword').val()
                };

                $.post('/api/auth/register', userData)
                    .done(function(response) {
                        alert('회원가입이 완료되었습니다.');
                        window.location.href = '/login.html';
                    })
                    .fail(function(error) {
                        alert('회원가입에 실패했습니다.');
                    });
            });
        });
    </script>
</body>
</html> 