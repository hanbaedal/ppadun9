<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사원 아이디 등록</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
        }
        
        .register-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .page-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-weight: 700;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-control {
            height: 45px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px 15px;
        }
        
        .form-control:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }
        
        .radio-item input[type="radio"] {
            margin-right: 5px;
        }
        
        .btn-primary {
            height: 45px;
            font-size: 16px;
            background-color: #4a90e2;
            border: none;
            border-radius: 8px;
            width: 100%;
        }
        
        .btn-primary:hover {
            background-color: #357abd;
        }
        
        .btn-outline-secondary {
            height: 45px;
            font-size: 16px;
            border-radius: 8px;
        }
        
        .verification-group {
            display: none;
            margin-top: 10px;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            color: #28a745;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="register-container">
        <h1 class="page-title">사원 아이디 등록</h1>
        <form id="registerForm">
            <!-- 이름 -->
            <div class="form-group">
                <label for="name">이름</label>
                <input type="text" class="form-control" id="name" name="name" maxlength="16" required>
                <div class="error-message" id="nameError">이름은 16자 이내로 입력해주세요.</div>
            </div>

            <!-- 직책 -->
            <div class="form-group">
                <label>직책</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="position1" name="position" value="대표" required>
                        <label for="position1">대표</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="position2" name="position" value="고문">
                        <label for="position2">고문</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="position3" name="position" value="감사">
                        <label for="position3">감사</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="position4" name="position" value="이사">
                        <label for="position4">이사</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="position5" name="position" value="본부장">
                        <label for="position5">본부장</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="position6" name="position" value="팀장">
                        <label for="position6">팀장</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="position7" name="position" value="팀원">
                        <label for="position7">팀원</label>
                    </div>
                </div>
            </div>

            <!-- 부서 -->
            <div class="form-group">
                <label>부서</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="dept1" name="department" value="경영" required>
                        <label for="dept1">경영</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="dept2" name="department" value="기획">
                        <label for="dept2">기획</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="dept3" name="department" value="재무">
                        <label for="dept3">재무</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="dept4" name="department" value="관리">
                        <label for="dept4">관리</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="dept5" name="department" value="운영">
                        <label for="dept5">운영</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="dept6" name="department" value="영업">
                        <label for="dept6">영업</label>
                    </div>
                </div>
            </div>

            <!-- 아이디 -->
            <div class="form-group">
                <label for="userId">아이디</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="userId" name="userId" 
                           pattern="^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,16}$" required>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="checkIdBtn">중복확인</button>
                    </div>
                </div>
                <div class="error-message" id="userIdError">영문자, 특수문자, 숫자를 포함하여 8~16자로 입력해주세요.</div>
                <div class="success-message" id="userIdSuccess">사용 가능한 아이디입니다.</div>
            </div>

            <!-- 비밀번호 -->
            <div class="form-group">
                <label for="password">비밀번호</label>
                <input type="password" class="form-control" id="password" name="password" 
                       minlength="8" maxlength="16" required>
                <div class="error-message" id="passwordError">비밀번호는 8~16자로 입력해주세요.</div>
            </div>

            <!-- 비밀번호 확인 -->
            <div class="form-group">
                <label for="confirmPassword">비밀번호 확인</label>
                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                <div class="error-message" id="confirmPasswordError">비밀번호가 일치하지 않습니다.</div>
            </div>

            <!-- 전화번호 -->
            <div class="form-group">
                <label for="phone">전화번호</label>
                <div class="input-group">
                    <input type="tel" class="form-control" id="phone" name="phone" 
                           pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}" placeholder="000-0000-0000" required>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="sendVerificationBtn">인증번호 발송</button>
                    </div>
                </div>
                <div class="error-message" id="phoneError">올바른 전화번호 형식이 아닙니다.</div>
            </div>

            <!-- 인증번호 -->
            <div class="form-group verification-group" id="verificationGroup">
                <label for="verificationCode">인증번호</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="verificationCode" name="verificationCode" readonly>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="verifyCodeBtn">확인</button>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" id="submitBtn" disabled>등록하기</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            let isIdAvailable = false;
            let isPhoneVerified = false;

            // 아이디 중복 확인
            $('#checkIdBtn').click(function() {
                const userId = $('#userId').val();
                if (!userId) {
                    $('#userIdError').show();
                    $('#userIdSuccess').hide();
                    return;
                }

                // 아이디 형식 검사
                const idPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,16}$/;
                if (!idPattern.test(userId)) {
                    $('#userIdError').show();
                    $('#userIdSuccess').hide();
                    return;
                }

                // 서버에 중복 확인 요청
                $.ajax({
                    url: '/api/auth/check-username',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ username: userId }),
                    success: function(response) {
                        if (response.available) {
                            $('#userIdError').hide();
                            $('#userIdSuccess').show();
                            isIdAvailable = true;
                        } else {
                            $('#userIdError').text('이미 사용 중인 아이디입니다.').show();
                            $('#userIdSuccess').hide();
                            isIdAvailable = false;
                        }
                        updateSubmitButton();
                    },
                    error: function() {
                        $('#userIdError').text('서버 오류가 발생했습니다.').show();
                        $('#userIdSuccess').hide();
                        isIdAvailable = false;
                        updateSubmitButton();
                    }
                });
            });

            // 비밀번호 확인
            $('#confirmPassword').on('input', function() {
                const password = $('#password').val();
                const confirmPassword = $(this).val();
                
                if (password === confirmPassword) {
                    $('#confirmPasswordError').hide();
                } else {
                    $('#confirmPasswordError').show();
                }
                updateSubmitButton();
            });

            // 전화번호 인증
            $('#sendVerificationBtn').click(function() {
                const phone = $('#phone').val();
                if (!phone) {
                    $('#phoneError').show();
                    return;
                }

                // 전화번호 형식 검사
                const phonePattern = /^[0-9]{3}-[0-9]{4}-[0-9]{4}$/;
                if (!phonePattern.test(phone)) {
                    $('#phoneError').show();
                    return;
                }

                // 테스트용 인증번호 생성 (실제로는 서버에서 생성)
                const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                
                // 인증번호 입력란에 자동 입력
                $('#verificationCode').val(verificationCode);
                $('#verificationGroup').show();
            });

            // 인증번호 확인
            $('#verifyCodeBtn').click(function() {
                const code = $('#verificationCode').val();
                if (code) {
                    alert('인증이 완료되었습니다.');
                    $('#verificationCode').prop('disabled', true);
                    $('#verifyCodeBtn').prop('disabled', true);
                    isPhoneVerified = true;
                    updateSubmitButton();
                }
            });

            // 등록 버튼 상태 업데이트
            function updateSubmitButton() {
                const isFormValid = 
                    $('#name').val() &&
                    $('input[name="position"]:checked').val() &&
                    $('input[name="department"]:checked').val() &&
                    isIdAvailable &&
                    $('#password').val().length >= 8 &&
                    $('#password').val() === $('#confirmPassword').val() &&
                    isPhoneVerified;

                $('#submitBtn').prop('disabled', !isFormValid);
            }

            // 폼 제출
            $('#registerForm').submit(function(e) {
                e.preventDefault();
                
                if (!isIdAvailable) {
                    alert('아이디 중복확인을 해주세요.');
                    return;
                }

                if (!isPhoneVerified) {
                    alert('전화번호 인증을 완료해주세요.');
                    return;
                }

                const formData = {
                    name: $('#name').val(),
                    position: $('input[name="position"]:checked').val(),
                    department: $('input[name="department"]:checked').val(),
                    userId: $('#userId').val(),
                    password: $('#password').val(),
                    phone: $('#phone').val()
                };

                $.ajax({
                    url: '/api/auth/register',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(response) {
                        alert('등록이 완료되었습니다.');
                        window.location.href = '/login.html';
                    },
                    error: function() {
                        alert('등록에 실패했습니다.');
                    }
                });
            });

            // 입력 필드 변경 시 등록 버튼 상태 업데이트
            $('input').on('input change', updateSubmitButton);
        });
    </script>
</body>
</html>
